{
   "Description" : "AWS CloudFormation Sample Template VPC_RDS_DB_Instance: Sample template showing how to create an RDS DBInstance in an existing Virtual Private Cloud (VPC). **WARNING** This template creates an Amazon Relational Database Service database instance. You will be billed for the AWS resources used if you create a stack from this template.",
   "Outputs" : {
      "DBPassword" : {
         "Value" : {
            "Ref" : "DBPassword"
         },
         "Description" : "DBPassword"
      },
      "DBUsername" : {
         "Description" : "DBUsername",
         "Value" : {
            "Ref" : "DBUsername"
         }
      },
      "DBPortNumber" : {
         "Value" : {
            "Fn::GetAtt" : [
               "MyDB",
               "Endpoint.Address"
            ]
         },
         "Description" : "PortNumber"
      }
   },
   "AWSTemplateFormatVersion" : "2010-09-09",
   "Resources" : {
      "DBSecurityGroup" : {
         "Type" : "AWS::EC2::SecurityGroup",
         "Properties" : {
            "SecurityGroupIngress" : {
               "IpProtocol" : "tcp",
               "SourceSecurityGroupId" : {
                  "Ref" : "AppServerSecurityGroupId"
               },
               "ToPort" : "5432",
               "FromPort" : "5432"
            },
            "GroupDescription" : "Security group for RDS DB Instance.",
            "VpcId" : {
               "Ref" : "VPCId"
            }
         }
      },
      "MyDBSubnetGroup" : {
         "Properties" : {
            "SubnetIds" : {
               "Ref" : "Subnets"
            },
            "DBSubnetGroupDescription" : "Subnets available for the RDS DB Instance"
         },
         "Type" : "AWS::RDS::DBSubnetGroup"
      },
      "MyDB" : {
         "Properties" : {
            "DBName" : {
               "Ref" : "DBName"
            },
            "DBInstanceClass" : {
               "Ref" : "DBClass"
            },
            "MasterUsername" : {
               "Ref" : "DBUsername"
            },
            "AllocatedStorage" : {
               "Ref" : "DBAllocatedStorage"
            },
            "MasterUserPassword" : {
               "Ref" : "DBPassword"
            },
            "MultiAZ" : "false",
            "VPCSecurityGroups" : [
               {
                  "Ref" : "DBSecurityGroup"
               }
            ],
            "Engine" : {
               "Ref" : "Engine"
            },
            "DBSubnetGroupName" : {
               "Ref" : "MyDBSubnetGroup"
            },
            "EngineVersion" : {
               "Ref" : "EngineVersion"
            }
         },
         "Type" : "AWS::RDS::DBInstance"
      }
   },
   "Parameters" : {
      "DBUsername" : {
         "MaxLength" : 16,
         "Default" : "admin",
         "ConstraintDescription" : "must begin with a letter and contain only alphanumeric characters.",
         "MinLength" : 1,
         "Type" : "String",
         "NoEcho" : true,
         "Description" : "The database admin account username",
         "AllowedPattern" : "[a-zA-Z][a-zA-Z0-9]*"
      },
      "DBPassword" : {
         "MaxLength" : 41,
         "Default" : "password",
         "ConstraintDescription" : "must contain only alphanumeric characters.",
         "Type" : "String",
         "MinLength" : 8,
         "AllowedPattern" : "[a-zA-Z0-9]*",
         "Description" : "The database admin account password",
         "NoEcho" : true
      },
      "DBName" : {
         "ConstraintDescription" : "must begin with a letter and contain only alphanumeric characters.",
         "Default" : "MyDatabase",
         "Description" : "The database name",
         "AllowedPattern" : "[a-zA-Z][a-zA-Z0-9]*",
         "MinLength" : 1,
         "MaxLength" : 64,
         "Type" : "String"
      },
      "AppServerSecurityGroupId" : {
         "Description" : "App server security group id",
         "Type" : "String"
      },
      "DBAllocatedStorage" : {
         "Default" : "5",
         "ConstraintDescription" : "must be between 5 and 1024Gb.",
         "MaxValue" : 1024,
         "Description" : "The size of the database (Gb)",
         "MinValue" : 5,
         "Type" : "Number"
      },
      "DBClass" : {
         "ConstraintDescription" : "must select a valid database instance type.",
         "AllowedValues" : [
            "db.m1.large",
            "db.m1.medium",
            "db.m1.small",
            "db.m1.xlarge",
            "db.m2.2xlarge",
            "db.m2.4xlarge",
            "db.m2.xlarge",
            "db.m3.2xlarge",
            "db.m3.large",
            "db.m3.medium",
            "db.m3.xlarge",
            "db.m4.10xlarge",
            "db.m4.2xlarge",
            "db.m4.4xlarge",
            "db.m4.large",
            "db.m4.xlarge",
            "db.r3.2xlarge",
            "db.r3.4xlarge",
            "db.r3.8xlarge",
            "db.r3.large",
            "db.r3.xlarge",
            "db.t1.micro",
            "db.t2.large",
            "db.t2.medium",
            "db.t2.micro",
            "db.t2.small"
         ],
         "Default" : "db.t2.micro",
         "Description" : "Database instance class",
         "Type" : "String"
      },
      "VPCId" : {
         "Type" : "String",
         "Description" : "VPCId of your existing Virtual Private Cloud (VPC)"
      },
      "Engine" : {
         "Description" : "DB Engine",
         "AllowedValues" : [
            "MySQL",
            "aurora",
            "mariadb",
            "oracle-ee",
            "oracle-se",
            "oracle-se1",
            "postgres",
            "sqlserver-ee",
            "sqlserver-ex",
            "sqlserver-se",
            "sqlserver-web"
         ],
         "Default" : "postgres",
         "Type" : "String"
      },
      "Subnets" : {
         "Type" : "CommaDelimitedList",
         "Description" : "The list of SubnetIds, for at least two Availability Zones in the region in your Virtual Private Cloud (VPC)"
      },
      "EngineVersion" : {
         "Type" : "String",
         "Description" : "Engine Version",
         "Default" : "9.5.2"
      }
   }
}
