{"AWSTemplateFormatVersion":"2010-09-09","Parameters":{"KeyName":{"Type":"AWS::EC2::KeyPair::KeyName","ConstraintDescription":"Must be a valid keyname"}},"Outputs":{"KeyName":{"Description":"EC2 Keyname to Access Bastion Host","Value":{"Ref":"KeyName"}},"VPC":{"Description":"VPC id","Value":{"Ref":"VPC"}},"SecurityGroup":{"Description":"Main VPC Security Group id","Value":{"Ref":"SecurityGroup"}},"PrivateSubnet1b":{"Description":"Private EC2 Instance Subnet 1","Value":{"Ref":"PrivateSubnet1b"}},"PublicSubnet1b":{"Description":"Public ELB Subnet 1","Value":{"Ref":"PublicSubnet1b"}},"PrivateSubnet1c":{"Description":"Private EC2 Instance Subnet 2","Value":{"Ref":"PrivateSubnet1c"}},"PublicSubnet1c":{"Description":"Public EC2 Instance Subnet 2","Value":{"Ref":"PublicSubnet1c"}},"BastionHostEIP":{"Description":"Bastion Host IP Address","Value":{"Ref":"BastionHostEIP"}}},"Resources":{"VPC":{"Properties":{"EnableDnsSupport":"true","EnableDnsHostnames":"true","CidrBlock":"10.0.0.0/16"},"Type":"AWS::EC2::VPC"},"PublicRouteTable":{"Properties":{"VpcId":{"Ref":"VPC"}},"DependsOn":"VPC","Type":"AWS::EC2::RouteTable"},"InternetGateway":{"DependsOn":["VPC","PublicRouteTable"],"Type":"AWS::EC2::InternetGateway"},"VPCGatewayAttachment":{"Properties":{"InternetGatewayId":{"Ref":"InternetGateway"},"VpcId":{"Ref":"VPC"}},"DependsOn":["VPC","InternetGateway"],"Type":"AWS::EC2::VPCGatewayAttachment"},"PublicRoute":{"Properties":{"DestinationCidrBlock":"0.0.0.0/0","RouteTableId":{"Ref":"PublicRouteTable"},"GatewayId":{"Ref":"InternetGateway"}},"DependsOn":["VPCGatewayAttachment","InternetGateway","PublicRouteTable"],"Type":"AWS::EC2::Route"},"SecurityGroup":{"Properties":{"VpcId":{"Ref":"VPC"},"GroupDescription":"do not allow traffic in or out of vpc outside","SecurityGroupIngress":{"IpProtocol":"-1","FromPort":"-1","ToPort":"-1","CidrIp":"10.0.0.0/16"},"SecurityGroupEgress":{"IpProtocol":"-1","FromPort":"-1","ToPort":"-1","CidrIp":"0.0.0.0/0"}},"Type":"AWS::EC2::SecurityGroup"},"PrivateSubnet1b":{"Properties":{"AvailabilityZone":"us-east-1b","VpcId":{"Ref":"VPC"},"CidrBlock":"10.0.0.0/24"},"Type":"AWS::EC2::Subnet"},"PrivateRouteTable1b":{"Properties":{"VpcId":{"Ref":"VPC"}},"Type":"AWS::EC2::RouteTable"},"PrivateSubnetRouteTableAssociation1b":{"Properties":{"RouteTableId":{"Ref":"PrivateRouteTable1b"},"SubnetId":{"Ref":"PrivateSubnet1b"}},"Type":"AWS::EC2::SubnetRouteTableAssociation"},"PrivateRoute1b":{"Properties":{"DestinationCidrBlock":"0.0.0.0/0","RouteTableId":{"Ref":"PrivateRouteTable1b"},"NatGatewayId":{"Ref":"NatGateway1b"}},"DependsOn":["NatGateway1b","PrivateRouteTable1b"],"Type":"AWS::EC2::Route"},"PublicSubnet1b":{"Properties":{"AvailabilityZone":"us-east-1b","VpcId":{"Ref":"VPC"},"CidrBlock":"10.0.1.0/24"},"Type":"AWS::EC2::Subnet"},"NatEip1b":{"Properties":{"Domain":"VPC"},"Type":"AWS::EC2::EIP"},"NatGateway1b":{"Properties":{"AllocationId":{"Fn::GetAtt":["NatEip1b","AllocationId"]},"SubnetId":{"Ref":"PublicSubnet1b"}},"Type":"AWS::EC2::NatGateway"},"PublicSubnetRouteTableAssociation1b":{"Properties":{"RouteTableId":{"Ref":"PublicRouteTable"},"SubnetId":{"Ref":"PublicSubnet1b"}},"Type":"AWS::EC2::SubnetRouteTableAssociation"},"PrivateSubnet1c":{"Properties":{"AvailabilityZone":"us-east-1c","VpcId":{"Ref":"VPC"},"CidrBlock":"10.0.2.0/24"},"Type":"AWS::EC2::Subnet"},"PrivateRouteTable1c":{"Properties":{"VpcId":{"Ref":"VPC"}},"Type":"AWS::EC2::RouteTable"},"PrivateSubnetRouteTableAssociation1c":{"Properties":{"RouteTableId":{"Ref":"PrivateRouteTable1c"},"SubnetId":{"Ref":"PrivateSubnet1c"}},"Type":"AWS::EC2::SubnetRouteTableAssociation"},"PrivateRoute1c":{"Properties":{"DestinationCidrBlock":"0.0.0.0/0","RouteTableId":{"Ref":"PrivateRouteTable1c"},"NatGatewayId":{"Ref":"NatGateway1c"}},"DependsOn":["NatGateway1c","PrivateRouteTable1c"],"Type":"AWS::EC2::Route"},"PublicSubnet1c":{"Properties":{"AvailabilityZone":"us-east-1c","VpcId":{"Ref":"VPC"},"CidrBlock":"10.0.3.0/24"},"Type":"AWS::EC2::Subnet"},"NatEip1c":{"Properties":{"Domain":"VPC"},"Type":"AWS::EC2::EIP"},"NatGateway1c":{"Properties":{"AllocationId":{"Fn::GetAtt":["NatEip1c","AllocationId"]},"SubnetId":{"Ref":"PublicSubnet1c"}},"Type":"AWS::EC2::NatGateway"},"PublicSubnetRouteTableAssociation1c":{"Properties":{"RouteTableId":{"Ref":"PublicRouteTable"},"SubnetId":{"Ref":"PublicSubnet1c"}},"Type":"AWS::EC2::SubnetRouteTableAssociation"},"BastionHostEIP":{"Properties":{"Domain":"VPC"},"Type":"AWS::EC2::EIP"},"BastionHost":{"Properties":{"SubnetId":{"Ref":"PublicSubnet1b"},"SecurityGroupIds":[{"Ref":"BastionSecurityGroup"}],"KeyName":{"Ref":"KeyName"},"ImageId":"ami-6869aa05","InstanceType":"t2.micro"},"Type":"AWS::EC2::Instance"},"BastionHostEIPAssociation":{"Properties":{"AllocationId":{"Fn::GetAtt":["BastionHostEIP","AllocationId"]},"InstanceId":{"Ref":"BastionHost"}},"DependsOn":["BastionHostEIP","BastionHost"],"Type":"AWS::EC2::EIPAssociation"},"BastionSecurityGroup":{"Properties":{"VpcId":{"Ref":"VPC"},"GroupDescription":"Allow SSH traffic to bastion host","SecurityGroupIngress":{"IpProtocol":"tcp","FromPort":"22","ToPort":"22","CidrIp":"0.0.0.0/0"},"SecurityGroupEgress":{"IpProtocol":"tcp","FromPort":"22","ToPort":"22","CidrIp":"0.0.0.0/0"}},"Type":"AWS::EC2::SecurityGroup"}}}
